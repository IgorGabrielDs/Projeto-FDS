{% extends "base.html" %}
{% load static %}

{% block title %}{{ noticia.titulo }} • BRASA{% endblock %}

{% block content %}
  <article class="article">
    <header class="article-header" style="margin-top:28px">
      <h1 class="article-title">{{ noticia.titulo }}</h1>
      <p class="article-meta muted" style="margin-top:8px;">
        Publicado em {{ noticia.criado_em|date:"d/m/Y H:i" }}
      </p>
    </header>

    {% if noticia.imagem %}
      <figure class="article-cover">
        <img src="{{ noticia.imagem.url }}" alt="{{ noticia.titulo }}">
        {% if noticia.legenda %}<figcaption>{{ noticia.legenda }}</figcaption>{% endif %}
      </figure>
    {% endif %}

    <section class="article-body">
      {{ noticia.conteudo|linebreaks }}
    </section>

    <!-- ===== Votação (ÚNICA) ===== -->
    <section class="article-vote" aria-labelledby="vote-heading" style="margin-top:24px">
      <h2 id="vote-heading" class="sr-only">Avaliação</h2>

      <div class="vote-group"
           data-url="{% url 'noticias:votar' noticia.pk %}"
           data-auth="{{ user.is_authenticated|yesno:'1,0' }}"
           data-voto="{{ voto_usuario|default:0 }}"
           data-login-url="{% url 'login' %}">
        <!-- Upvote -->
        <button type="button"
                class="vote-btn up {% if voto_usuario == 1 %}is-active{% endif %}"
                aria-label="Votar positivo"
                data-valor="1">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <polygon points="12 4 4 12 9 12 9 20 15 20 15 12 20 12" />
          </svg>
          <span class="vote-count" data-count="up">{{ up }}</span>
        </button>

        <!-- Downvote -->
        <button type="button"
                class="vote-btn down {% if voto_usuario == -1 %}is-active{% endif %}"
                aria-label="Votar negativo"
                data-valor="-1">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <polygon points="12 20 20 12 15 12 15 4 9 4 9 12 4 12" />
          </svg>
          <span class="vote-count" data-count="down">{{ down }}</span>
        </button>
      </div>

      <span class="sr-only" aria-live="polite" id="vote-feedback"></span>

      <noscript>
        <form action="{% url 'noticias:votar' noticia.pk %}" method="post" style="display:inline">
          {% csrf_token %}
          <button class="vote-btn up" name="valor" value="1">▲ {{ up }}</button>
        </form>
        <form action="{% url 'noticias:votar' noticia.pk %}" method="post" style="display:inline">
          {% csrf_token %}
          <button class="vote-btn down" name="valor" value="-1">▼ {{ down }}</button>
        </form>
      </noscript>
    </section>
  </article>
{% endblock %}

{% block scripts %}
  <script src="{% static 'noticias/js/votar.js' %}"></script>
{% endblock %}